<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Mysql和Mysqld的区别</title>
    <url>/2021/03/22/Mysql%E5%92%8CMysqld%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
    <content><![CDATA[<p>mysql 是个命令行程序。</p>
<p>mysqld 是服务。</p>
<p>linux 系统里一般的服务都是以 d 结尾的，比如 httpd，vsftpd 等等。</p>
<p>d 的全拼应该是 daemon，也就是守护程序的意思，常驻于后台。</p>
]]></content>
  </entry>
  <entry>
    <title>backup_db.sh</title>
    <url>/2021/03/22/backup-db-sh/</url>
    <content><![CDATA[<p>#!/bin/bash<br>#0 0 * * *    sh /home/backup_db.sh</p>
<p>source /etc/profile</p>
<p>user=”root”<br>pass=”root”<br>db=”zabbix”<br>backup_dir=”/home/backup”</p>
<p>date=$(date +%Y%m%d%H%M%S)</p>
<p>mysqlpump=<code>which mysqlpump</code></p>
<p>if [ -d “${backup_dir}” ];then<br>    echo “backup mysql ${db} to ${backup_dir}”</p>
<pre><code>/usr/local/mysql/bin/mysqlpump -u$&#123;user&#125; -p$&#123;pass&#125; --set-gtid-purged=off --default-character-set=utf8 --single-transaction --complete-insert --max_allowed_packet=32M --default-parallelism=5 -B $&#123;db&#125; --log-error-file=$&#123;backup_dir&#125;/$&#123;db&#125;.$date.log &gt; $&#123;backup_dir&#125;/$&#123;db&#125;.$date.sql


find /home/backup -type f -mtime +30 -name &quot;*.sql&quot; -exec rm -f &#123;&#125; \;
find /home/backup -type f -mtime +30 -name &quot;*.log&quot; -exec rm -f &#123;&#125; \;
</code></pre>
<p>else<br>    mkdir -p ${backup_dir}<br>    ls -lh ${backup_dir}</p>
<p>fi</p>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
  </entry>
  <entry>
    <title>ubuntu——docker安装</title>
    <url>/2021/03/24/ubuntu%E2%80%94%E2%80%94docker%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<p>apt-get update<br>apt  install docker.io<br>docker version</p>
<p>安装指定版本或CE版本<br><a href="https://www.cnblogs.com/chengmf/p/13122013.html">https://www.cnblogs.com/chengmf/p/13122013.html</a></p>
<p>开机自启动<br>sudo systemctl enable docker</p>
]]></content>
  </entry>
  <entry>
    <title>docker内部基础服务安装</title>
    <url>/2021/03/24/docker%E5%86%85%E9%83%A8%E5%9F%BA%E7%A1%80%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<p>docker容器内apt换源<br>mv /etc/apt/sources.list /etc/apt/sources.list.bak</p>
<p>cat &lt;<EOF >/etc/apt/sources.list<br>deb <a href="http://mirrors.ustc.edu.cn/debian">http://mirrors.ustc.edu.cn/debian</a> stable main contrib non-free<br>deb <a href="http://mirrors.ustc.edu.cn/debian">http://mirrors.ustc.edu.cn/debian</a> stable-updates main contrib non-free<br>EOF</p>
<p>cat &lt;<EOF >/etc/apt/sources.list<br>deb <a href="http://mirrors.163.com/debian/">http://mirrors.163.com/debian/</a> jessie main non-free contrib<br>deb <a href="http://mirrors.163.com/debian/">http://mirrors.163.com/debian/</a> jessie-proposed-updates main non-free contrib<br>deb-src <a href="http://mirrors.163.com/debian/">http://mirrors.163.com/debian/</a> jessie main non-free contrib<br>deb-src <a href="http://mirrors.163.com/debian/">http://mirrors.163.com/debian/</a> jessie-proposed-updates main non-free contrib<br>EOF</p>
<p>apt update</p>
<p>apt-get update<br>安装yum<br>apt-get install yum -y<br>安装vim<br>apt-get install vim -y<br>安装ping<br>apt install iputils-ping -y<br>安装ps<br>apt-get install procps -y<br>安装ifconfig<br>apt-get install net-tools<br>安装sudo<br>apt-get install sudo<br>安装crontab<br>apt-get install cron<br>service cron status –查看cron的状态<br>service cron restart –重启crontab服务</p>
]]></content>
  </entry>
  <entry>
    <title>MariaDB 10.5.8 二进制安装</title>
    <url>/2021/03/29/MariaDB%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<p>基于Ubuntu20.04.01</p>
<p>1.路径规划与创建</p>
<p>   数据文件存储位置               /data/mysql/data<br>   日志文件存储位置               /data/logs/mysql<br>   binlog文件存储位置             /data/mysql<br>   缓存目录位置                   /dta/tmp</p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /data/mysql/data</span><br><span class="line">mkdir -p /data/logs/mysql</span><br><span class="line">mkdir -p /data/logs/tmp</span><br><span class="line">mkdir -p /data/tmp</span><br></pre></td></tr></table></figure>

<p>2.创建用户配置权限</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">useradd mysql</span><br><span class="line">chown -R mysql:mysql /data/mysql</span><br><span class="line">chown -R mysql:mysql /data/logs</span><br><span class="line">chown -R mysql:mysql /data/tmp</span><br><span class="line">chmod -R 775 /data/mysql</span><br><span class="line">chmod -R 775 /data/logs</span><br><span class="line">chmod -R 775 /data/tmp```</span><br></pre></td></tr></table></figure>

<p>3.上传安装包与依赖包并解压</p>
<p>   安装包：</p>
<p>​            <a href="https://downloads.mariadb.org/mariadb/+releases/">https://downloads.mariadb.org/mariadb/+releases/</a></p>
<p>   依赖包：</p>
<p>​            <a href="https://pan.baidu.com/s/1neVvaAUbeQ1xIj7bIUtSKA">https://pan.baidu.com/s/1neVvaAUbeQ1xIj7bIUtSKA</a> 提取码：ydx0</p>
<p>   上传mariadb-10.5.8-linux-systemd-x86_64.tar.gz至/tmp<br>   <code>tar zxvf mariadb-10.5.8-linux-x86_64.tar.gz -C /usr/local/</code><br>   <code>cd /usr/local/</code></p>
<p>​       把libtinfo.so.5依赖包放在该目录下：<br>​    /lib/x86_64-linux-gnu/<br>   <code>mv mariadb-10.5.8-linux-x86_64/ mysql</code></p>
<p>4.修改配置文件</p>
<p>   <code>vim /etc/my.cnf</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[client]</span><br><span class="line">port = 3306</span><br><span class="line">socket = /tmp/mysql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">user = mysql</span><br><span class="line">datadir = /data/mysql/data</span><br><span class="line">pid-file = /data/mysql/mysql.pid</span><br><span class="line">server-id = 50</span><br><span class="line">relay_log =/data/logs/mysql/mysql_relay.log</span><br><span class="line">bind-address = 0.0.0.0</span><br><span class="line"></span><br><span class="line">tmpdir=/data/tmp</span><br><span class="line"><span class="meta">#</span><span class="bash">当数据库是大量存储时建议指向TMP目录，否则做全表操作时临时空间会不足</span></span><br><span class="line"></span><br><span class="line">init_connect =&#x27;SET NAMES utf8&#x27;</span><br><span class="line">character-set-server = utf8</span><br><span class="line">skip-name-resolve</span><br><span class="line">back_log = 300</span><br><span class="line"></span><br><span class="line">max_connections = 8019</span><br><span class="line">max_connect_errors = 1024000</span><br><span class="line">open_files_limit = 65535</span><br><span class="line">table_open_cache = 2048</span><br><span class="line">max_allowed_packet = 50M</span><br><span class="line">max_heap_table_size = 512M</span><br><span class="line">tmp_table_size = 256M</span><br><span class="line"></span><br><span class="line">read_buffer_size = 2M</span><br><span class="line">read_rnd_buffer_size = 16M</span><br><span class="line">sort_buffer_size = 8M</span><br><span class="line">join_buffer_size = 8M</span><br><span class="line">key_buffer_size = 512M</span><br><span class="line">thread_cache_size = 128</span><br><span class="line"></span><br><span class="line">query_cache_type = 2</span><br><span class="line">query_cache_size = 128M</span><br><span class="line">query_cache_limit = 5M</span><br><span class="line">thread_stack = 192k</span><br><span class="line">ft_min_word_len = 4</span><br><span class="line"></span><br><span class="line">log_bin = /data/mysql/mysql_bin.log</span><br><span class="line">binlog_format = ROW</span><br><span class="line">expire_logs_days = 7</span><br><span class="line"></span><br><span class="line">log_error = /data/logs/mysql/mysql_error.log</span><br><span class="line">slow_query_log = 1</span><br><span class="line">long_query_time = 1</span><br><span class="line">log_slow_verbosity=query_plan</span><br><span class="line">slow_query_log_file = /data/logs/mysql/mysql_slow.log</span><br><span class="line">performance_schema = 0</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">skip-external-locking #跳过外部锁定，避免external locking</span><br><span class="line"></span><br><span class="line">bulk_insert_buffer_size = 64M</span><br><span class="line">myisam_sort_buffer_size = 128M</span><br><span class="line">myisam_max_sort_file_size = 10G</span><br><span class="line">myisam_repair_threads = 1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##InnoDB###</span></span></span><br><span class="line">default_storage_engine = InnoDB</span><br><span class="line">innodb_file_per_table = 1</span><br><span class="line">innodb_open_files = 500</span><br><span class="line">innodb_buffer_pool_size = 2048M</span><br><span class="line">innodb_write_io_threads = 8</span><br><span class="line">innodb_read_io_threads = 8</span><br><span class="line">innodb_thread_concurrency = 16</span><br><span class="line">innodb_purge_threads = 1</span><br><span class="line">innodb_flush_log_at_trx_commit = 1</span><br><span class="line">innodb_log_buffer_size = 8M</span><br><span class="line">innodb_log_file_size = 256M</span><br><span class="line">innodb_log_files_in_group = 3</span><br><span class="line">innodb_max_dirty_pages_pct = 90</span><br><span class="line">innodb_lock_wait_timeout = 10</span><br><span class="line">innodb_autoinc_lock_mode = 2</span><br><span class="line">innodb_doublewrite = 1</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##New ADD</span></span></span><br><span class="line">innodb_rollback_on_timeout = 1</span><br><span class="line">innodb_force_recovery=0</span><br><span class="line">interactive_timeout = 28800</span><br><span class="line">wait_timeout = 120</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line">quick</span><br><span class="line">max_allowed_packet = 16M</span><br><span class="line"></span><br><span class="line">[myisamchk]</span><br><span class="line">key_buffer_size = 512M</span><br><span class="line">sort_buffer_size = 8M</span><br><span class="line">read_buffer = 4M</span><br><span class="line">write_buffer = 4M</span><br></pre></td></tr></table></figure>



<p>5.初始化数据库</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">/usr/local/mysql/scripts/mysql_install_db --basedir=/usr/local/mysql --datadir=/data/mysql/data --user=mysql</span><br></pre></td></tr></table></figure>

<p>6.设置启动文件<br>   <code>cp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql</code></p>
<p>7.启动数据库<br>   <code>/etc/init.d/mysql start</code><br>8.配置环境变量<br>   <code>vim /etc/profile</code></p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">在最后面添加</span></span><br><span class="line">export MYSQL_HOME=/usr/local/mysql</span><br><span class="line">export PATH=$MYSQL_HOME/bin:$PATH</span><br></pre></td></tr></table></figure>

<p>   <code>source /etc/profile</code></p>
<p>9.使用无密码登录，添加登录密码</p>
<p>   <code>mysql</code></p>
<p>​     无密码登录使用如下命令：</p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ALTER USER root@localhost IDENTIFIED VIA mysql_native_password USING PASSWORD(&quot;admin&quot;);</span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>

<p>​    之后用密码正常登录即可</p>
]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>MariaDB</tag>
      </tags>
  </entry>
  <entry>
    <title>Mysql 5.7.28 二进制安装</title>
    <url>/2021/03/30/Mysql%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<ul>
<li>基于Centos7.6</li>
</ul>
<p>1.清理MariaBD环境(MariaDB与MySQL可能会有冲突)</p>
<p>​    <code>rpm -qa |grep mariadb</code></p>
<p>​    <code>yum -y remove mariadb-libs</code></p>
<p>2.路径规划与创建</p>
<p>   软件安装目录                  /usr/local/mysql/<br>   数据文件存储位置           /data/mysql/date/3306<br>   日志文件存储位置           /data/mysql/logs/3306<br>   binlog文件存储位置        /binlog/3306<br>   缓存目录位置                  /data/mysql/tmp/3306</p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /usr/local/mysql</span><br><span class="line">mkdir -p /data/mysql/data/3306</span><br><span class="line">mkdir -p /data/mysql/logs/3306</span><br><span class="line">mkdir -p /binlog/3306</span><br><span class="line">mkdir -p /data/mysql/tmp/3306</span><br></pre></td></tr></table></figure>

<p>​     正式环境软件安装目录、数据文件存储目录、binlog文件目录应该分别放在三个磁盘上</p>
<p>3.创建用户配置权限</p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">useradd mysql -s /sbin/nologin		#创建mysql用户和组，不需要其登录系统</span><br><span class="line">id mysql				#查看用户和属组信息</span><br><span class="line">chown -R mysql.mysql /usr/local/mysql /data /binlog</span><br></pre></td></tr></table></figure>

<p>4.下载安装包、依赖包，上传至/tmp，解压、移动、安装依赖包</p>
<p>   安装包下载路径：<a href="https://downloads.mysql.com/archives/community/">https://downloads.mysql.com/archives/community/</a></p>
<p>   依赖包下载路径：<a href="https://pan.baidu.com/s/1t-YUaG9gyDuse9fo1CTdpQ">https://pan.baidu.com/s/1t-YUaG9gyDuse9fo1CTdpQ</a>    提取码：aqrt</p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tar zxvf mysql-5.7.28-linux-glibc2.12-x86_64.tar.gz</span><br><span class="line">mv mysql-5.7.28-linux-glibc2.12-x86_64/* /usr/local/mysql</span><br><span class="line">rm -rf mysql-5.7.28-linux-glibc2.12-x86_64		#该文件夹为空，删除即可</span><br><span class="line">rpm -ivh libaio-devel-0.3.109-13.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p>5.更改权限，设置环境变量</p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/mysql</span><br><span class="line">chown -R mysql. *</span><br></pre></td></tr></table></figure>

 <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vi /etc/profile		#增加如下环境变量参数</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">export PATH=/usr/local/mysql/bin:$PATH</span><br><span class="line"><span class="meta">#</span><span class="bash">把安装目录加进去，告诉系统找MySQL命令的时候去这个目录找</span></span><br><span class="line">source /etc/profile		#使配置文件生效</span><br><span class="line">mysql -V			#设置正确应该能看到版本</span><br></pre></td></tr></table></figure>

<p>6.MySQL初始化</p>
<p><code>mysqld --initialize-insecure --user=mysql --basedir=/usr/local/mysql --datad ir=/data/mysql/date/3306</code></p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta"> #</span><span class="bash">如下回显表示初始化成功</span></span><br><span class="line">2021-03-30T17:16:23.673331Z 0 [Warning] TIMESTAMP with implicit DEFAULT value is deprecated. Please</span><br><span class="line"> use --explicit_defaults_for_timestamp server option (see documentation for more details).2021-03-30T17:16:23.911662Z 0 [Warning] InnoDB: New log files created, LSN=45790</span><br><span class="line">2021-03-30T17:16:23.947089Z 0 [Warning] InnoDB: Creating foreign key constraint system tables.</span><br><span class="line">2021-03-30T17:16:24.004815Z 0 [Warning] No existing UUID has been found, so we assume that this is the first time that this server has been started. Generating a new UUID: a7605f01-917b-11eb-a488-000c298178f9.2021-03-30T17:16:24.005892Z 0 [Warning] Gtid table is not ready to be used. Table &#x27;mysql.gtid_execu</span><br><span class="line">ted&#x27; cannot be opened.2021-03-30T17:16:24.418994Z 0 [Warning] CA certificate ca.pem is self signed.</span><br><span class="line">2021-03-30T17:16:24.884481Z 1 [Warning] root@localhost is created with an empty password ! Please c</span><br><span class="line">onsider switching off the --initialize-insecure option.</span><br><span class="line"><span class="meta">#</span><span class="bash">使用参数mysqld –initialize有初始化密码，使用参数mysqld –initialize-insecure为空密码</span></span><br></pre></td></tr></table></figure>

<p>7.修改配置文件</p>
   <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cat &gt; &#x2F;etc&#x2F;my.cnf &lt;&lt;EOF</span><br><span class="line">[mysqld]</span><br><span class="line">user&#x3D;mysql</span><br><span class="line">basedir&#x3D;&#x2F;usr&#x2F;local&#x2F;mysql</span><br><span class="line">datadir&#x3D;&#x2F;data&#x2F;mysql&#x2F;date&#x2F;3306</span><br><span class="line">server_id&#x3D;6</span><br><span class="line">port&#x3D;3306</span><br><span class="line">socket&#x3D;&#x2F;tmp&#x2F;mysql.sock</span><br><span class="line">[mysql]</span><br><span class="line">socket&#x3D;&#x2F;tmp&#x2F;mysql.sock</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>8.准备MySQL启动脚本</p>
   <figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/mysql/support-files/</span><br><span class="line">cp mysql.server /etc/init.d/mysqld	#拷贝MySQL的启动脚本至系统软件管理目录中</span><br></pre></td></tr></table></figure>

<p>9.启动数据库，修改登录密码</p>
   <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">service mysqld start或systemctl start mysqld</span><br><span class="line">mysql	#此时是空密码，输入mysql直接可以进入数据库</span><br></pre></td></tr></table></figure>

   <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">SET password&#x3D;PASSWORD(&#39;root&#39;);	#修改密码为root</span><br><span class="line">mysql -uroot -proot	#使用新密码登录数据库，至此安装完毕</span><br></pre></td></tr></table></figure>



]]></content>
      <categories>
        <category>数据库</category>
      </categories>
      <tags>
        <tag>Mysql</tag>
      </tags>
  </entry>
</search>
